---
title: "Week 14 Slides"
subtitle: "Topic Modeling"
author: "**Isabella Velásquez and Maryrose Weatherton**"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: xaringan::moon_reader
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r, echo=FALSE}
# then load all the relevant packages
pacman::p_load(pacman, knitr, tidyverse, readxl)
```

```{r xaringanExtra-clipboard, echo=FALSE}
# these allow any code snippets to be copied to the clipboard so they 
# can be pasted easily
htmltools::tagList(
    xaringanExtra::use_clipboard(
        button_text = "<i class=\"fa fa-clipboard\"></i>",
        success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    ),
    rmarkdown::html_dependency_font_awesome()
)
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

# Purpose and Agenda

This week, we'll continue our exploration of text analysis specifically with topic modeling. Topic modeling is a method for unsupervised classification of such text---meaning no codes or themes for documents are needed in advance, It similar to clustering on numeric data, which finds natural groups of items even when we’re not sure what we’re looking for.

## What we'll do in this presentation

- Discussion
- Key Concept: Topic modeling
- Code-along and data
- Discussion
- What's next: Assignment(s) and Readings

---

## TNVoice

TNVoice (TN Volunteer Online Instructor & Course Evaluations) will open to students on Monday, November 20 and will remain open until 11:59 on Wednesday, December 6.

- Should be available in your email or on Canvas
- Can help provide evidence of the effectiveness of the class in future CVs/materials

---

# Importing data in other formats

* Google Sheets: googlesheets4 provides an R interface to Google Sheets via the Sheets API v4.
* Microsoft Word: docxtractr (for tables in Word), readtext, officer
* PDFs: pdftools, tabulizer
* SAS/SPSS/Stata: the haven package reads in files of various formats

---

# Discussion

.panelset[

.panel[.panel-name[Definition]

Topic modeling

- A technique used in natural language processing and machine learning 
- Used to automatically identify and extract hidden topics or themes from a collection of documents or text data
- Discover the underlying structure or patterns in a large corpus of text without prior knowledge of what those topics might be

]

.panel[.panel-name[Background]

- Traditionally, something like what topic modeling can produce has been achieved through _thematic, qualitative analysis_ of text data
- However, the power of computers --- even your own computer --- can be leveraged to achieve something like what thematic, qualitative analysis can 
- Such computer-driven analyses go by many names that refer to similar but distinct techniques, including: 
    - natural language processing (NLP)
    - computational text analysis
    - computational linguistics
    - text mining

]

.panel[.panel-name[Discussion Question]

- What are some ways you have explored or described the themes in text?
- What do you see as the potential of analyzing text with your computer?

]
]

---

# Prepping your data

.panelset[

.panel[.panel-name[Data Collection and Cleaning]

- Gathering the text that you want to analyze
- Handling missing data
- Correcting typos or errors
- Standardizing text format (e.g., lowercasing all text)
- Text tokenization
- Stopword removal

```{r}
#| echo: false
#| out.width: 100%
#| fig-align: center
knitr::include_graphics('tmwr_0101.png')
```

]

.panel[.panel-name[Exploratory Data Analysis (EDA)]

- Basic statistics: number of documents and the total number of words
- Word frequency analysis
- Word clouds and other visualizations

]
]

---

# Key Concept: Topic modeling

.panelset[

.panel[.panel-name[LDA and topic models]

- Latent Dirichlet allocation (LDA) is a method for fitting a topic model.
    - Each document is a mixture of topics, and each topic is a mixture of words; this means that documents share similarities based on the distribution of topics.
    - Words can be shared between topics; this means that topics may overlap in their word distributions, indicating thematic similarities.

]

.panel[.panel-name[*k*]

- A key aspect of topic modeling is determining *k*, the number of topics.
- Choosing the right *k* is critical for model accuracy and interpretability.
- Various methods, help in selecting an appropriate *k*, but **there's no one criterion used to select k**, and often analysts consider a variety of solutions with different numbers of topics (different *k*s)

]

.panel[.panel-name[Interpretation]

- The interpretation of topic models is a non-trivial step.
- It involves understanding the thematic substance of each topic based on the distribution of words.
- Effective interpretation requires domain knowledge and sometimes iterative refinement of the model.

]
]

---

# Key Concept: Document-term matrix

.panelset[

.panel[.panel-name[Document-term matrix]

**Document-term matrix (DTM)**: Transform your tokenized and preprocessed text data into a DTM. 

- Each row represents one document (such as a book or article)
- Each column represents one term, and
- Each value (typically) contains the number of appearances of that term in that document

]

.panel[.panel-name[Converting to and from non-tidy formats]

- A DTM is typically comparable to a tidy data frame after a count or a group_by/summarize that contains counts or another statistic for each combination of a term and document.
- DTM objects cannot be used directly with tidy tools.
- The tidytext package provides two verbs that convert between the two formats:
    - `tidy()` turns a document-term matrix into a tidy data frame
    - `cast()` turns a tidy one-term-per-row data frame into a matrix

]
]

---

# Key Concept: The topicmodels package

.panelset[

.panel[.panel-name[topicmodels]

The topicmodels package provides basic infrastructure for fitting topic models based on data structures

]

.panel[.panel-name[AssociatedPress]

- Here's a snippet showing how you can use the topicmodels package with the AssociatedPress dataset, an example of a DocumentTermMatrix:

```{r, eval = TRUE, echo = TRUE}
library(topicmodels)

data("AssociatedPress", package = "topicmodels")
AssociatedPress
```

]

.panel[.panel-name[Fitting the model]

We can use the `LDA()` function from the topicmodels package, setting k = 10, to create a ten-topic LDA model.

```{r, eval = TRUE, echo = TRUE, cache = TRUE}
lda_model <- LDA(AssociatedPress, k = 10, control = list(seed = 1234))
lda_model
```

]

.panel[.panel-name[Topics]

Using `terms()`, we can get the following results:

- **Topic Labels:** The numbers at the top represent the topics generated by the LDA model, ranging from Topic 1 to Topic 10. These labels are typically generated automatically by the model.
- **Top Words in Each Topic:** Each row under the topic labels lists the top words associated with that topic.
- **Interpreting Topics:** To interpret the topics, you can examine the most significant words in each topic and try to identify common themes or subjects.

]

.panel[.panel-name[Topics]

```{r, eval = TRUE, echo = TRUE}
topics <- terms(lda_model, 6)
print(topics)
```

]
]

---

## Interpreting models

- Topic modeling is very powerful: you can estimate the topics that describe 100s, 1000s, or 10,000+ documents quickly.
- But, it is not a panacea, and it is often important to note that the topics identified through topic modeling _may not validly characterize what is in the documents_; carefully reviewing the topics, qualitatively reading sample documents to see how well the topics in fact describe them, and thoughtfully reporting results is necessary.

---

# The whole game

```{r}
#| echo: false
#| out.width: 80%
#| fig-align: center
knitr::include_graphics('tmwr_0601.png')
```

---

# Code-along

.panelset[

.panel[.panel-name[Loading package and data]

- Let's start by examining topics from the AssociatedPress dataset included with the topicmodels package.
- First, install and load the topicmodels package. Then, load the AssociatedPress dataset.

```{r, echo = TRUE, eval = FALSE}
# install.packages("topicmodels")
library(topicmodels)

data("AssociatedPress")
```

**A key thing to note here is the format of this data; when you use your own data, getting it into the right "form"--a document-term matrix--is essential. More on how to do that is [here](https://www.tidytextmining.com/topicmodeling).**

]

.panel[.panel-name[LDA()]

- Let's set the number of topics we want with the `LDA()` function
- `k` is the number of topics we want to find
- We use the code `control = list(seed = 1234)` to set a seed so that the output of the model is predictable

```{r, echo = TRUE, eval = FALSE}
ap_lda <- LDA(AssociatedPress, k = 2, control = list(seed = 1234))
ap_lda
```

]

.panel[.panel-name[Word-topic probabilities]

- We need to find the per-topic-per-word probabilities of our dataset. 
- This will break our dataset into one-topic-per-term-per-row format, where the probability listed is the probability of a term being generated in each topic.
- This method is from the tidytext package.

```{r, echo = TRUE, eval = FALSE}
library(tidytext)

ap_topics <- tidy(ap_lda, matrix = "beta")
ap_topics
```

]

.panel[.panel-name[Finding top terms]

- We can use `slice_max()` from dplyr to find the top 10 terms for each topics
- This will be a tidy data frame, which then allows us to use ggplot2 to visualize our topics.

```{r, echo = TRUE, eval = FALSE}
library(tidyverse)

ap_top_terms <- ap_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% 
  ungroup() %>%
  arrange(topic, -beta)

ap_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered()
```

- How would you name each of these topics? Let's talk through each of them.

]
]

---

# What's next?

.panelset[

.panel[.panel-name[Weekly Assignment]

- In this week's assignment, you will perform topic modeling on a dataset of your choosing, preferably from your own research.
- It is likely you will want to prepare and tidy your dataset before starting the topic modeling process. Don't forget the skills you have used through this point in the semester---they are just as relevant now!!
- Lastly, using your own data may be hard; you shouldn't look for perfect or even very good output, instead celebrating any results/output you can produce with their data! That's what we're looking for from this assignment.
    - There's also a backup dataset you can use if you don't have one - details in the assignment doc on how they can read it directly in from GitHub.
    
]

.panel[.panel-name[Final Projects]

- How are you doing? Your final project _presentation_ is coming up soon! Please see details [here](https://utk.instructure.com/courses/184613/assignments/1607692)
- Next week, we'll have time reserved to prepare for your final project presentations (and _reports_ due after your _presentations_)

]

.panel[.panel-name[Readings]

**Substantive reading(s):**

> Nelson, L. K., Burk, D., Knudsen, M., & McCall, L. (2021). The future of coding: A comparison of hand-coding and three types of computer-assisted text analysis methods. Sociological Methods & Research, 50(1), 202-237.

*This is a phenomenal introduction not only to topic modeling, but also other computational text analysis methods. Also, refer back to the reading from last week for a nice example of how to write up a topic modeling study!*

This is linked in Canvas.

**Technical reading(s):**

> Topic modeling: https://www.tidytextmining.com/topicmodeling

This is also linked in Canvas.

]

.panel[.panel-name[Survey!]

If we have time left over, please use it to take the UTK Voices survey!


]

]