---
title: "Week 10 Assignment"
author: "Student Name"
date: "Assignment Due Date"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Step 1

First, let's load the tidyverse package and another that we haven't used yet - readxl. You will likely need to install this from CRAN using `install.packages()`

```{r}
library(tidyverse)
library(readxl)
```

## Step 2

```{r}
dat <- read_excel("ntps2021_7341_s1s.xlsx")
dat

state_by_region <- read_csv("https://github.com/cphalpert/census-regions/blob/master/us%20census%20bureau%20regions%20and%20divisions.csv?raw=true")
```

When we read this in, we may notice some unexpected things with the resulting output. The second row is "State" and the third is "All public schools", followed by a missing row and then "State" again!

The problem is this file has _aggregate_ data for all public schools before the state-specific data. An easy solution is to read the data in once more, but to skip a number of rows. Try adding the `skip` argument to `read_excel()` below, e.g. `read_excel(file_name, skip = 2)`. You will need to fiddle with the value for skip (changing it from 2 to the appropriate number, so that each row in your data frame represents a single state).

## Step 3

```{r}
dat <- read_excel("ntps2021_7341_s1s.xlsx", skip = 5)
dat

glimpse(dat)
```

## Step 4

The data still isn't quite right. The 2nd variable is supposed to represent the average number of nurses per school in the state. The 4th variable represents the number of students in a school per nurse, on average, for the schools in that state. The 3rd variable is simply an empty column that can be removed. Let's clean up our data, renaming the 2nd and 4th variables with a _short, easy-to-remember name_, and dropping the fourth variable from the data. We can use `select()` to do all of these. Refer to the documentation for `select()` if you need a refresher! One tip - you can refer to the variables simply by their number when renaming them, i.e. `select(ave_nurses = 2)`.

Documentation for `select()`: https://dplyr.tidyverse.org/reference/select.html

```{r}
dat_selected <- dat %>% 
    select(State, 
           average_nurses = 2,
           nurses_per_student = 4)

dat_selected
```

## Step 5

There are some missing values in the variable for the state. Let's remove those with `filter()`, removing the NA values using this dplyr function. Check out the documentation here for a refresher:

https://dplyr.tidyverse.org/reference/filter.html

```{r}
dat_filtered <- dat_selected %>% 
    filter(!is.na(State))
```

## Step 6

The key challenge at this point is that we need the data to be in _long_ format. 

```{r}
dat_filtered %>% 
    glimpse()

dat_long <- dat_filtered %>% 
    pivot_longer(-State, names_to = "variable", values_to = "values")

dat_joined <- dat_long %>% 
    left_join(state_by_region)
```

## Step 7

```{r}
dat_joined %>% 
    group_by(Region, variable) %>% 
    summarize(mean_value = mean(values))
```

## Step 8

```{r}
dat_wide <- dat_joined %>% 
    pivot_wider(names_from = "variable", values_from = "values")

dat_wide %>% 
    glimpse()
```

## Reach

Create a graph!

## Rubric

|                     | Points Possible | Points Earned |
|---------------------|-----------------|---------------|
| File knits          | 5               |               |
| Code is appropriate | 5               |               |
| Question 1 answered | 5               |               |
| Question 2 answered | 5               |               |
| Question 3 answered | 5               |               |
| Question 4 answered | 5               |               |

## Knit and Submit

Complete the following steps to knit and publish your work:

1.  First, change the name of the `author:` in the [YAML header](https://bookdown.org/yihui/rmarkdown-cookbook/rmarkdown-anatomy.html#yaml-metadata) at the very top of this document to your name. The YAML header controls the style and feel for knitted document but doesn't actually display in the final output.

2.  Next, click the knit button in the toolbar above to "knit" your R Markdown document to a [HTML](https://bookdown.org/yihui/rmarkdown/html-document.html) file that will be saved in your R Project folder. You should see a formatted webpage appear in your Viewer tab in the lower right pan or in a new browser window. Let's us know if you run into any issues with knitting.

3. Upload the HTML file that is now present in the same folder as this R Markdown file to Canvas to receive credit for this assignment!