---
title: "Week 11 Slides"
subtitle: "Mapping, Part 1"
author: "**Isabella Velásquez and Maryrose Weatherton**"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: xaringan::moon_reader
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(dplyr)
elsi_data <- readr::read_csv("https://github.com/utkeds/f23-founds-eds/blob/main/data/ELSI_csv_export_6383262475806903427192.csv?raw=true", skip = 6) %>% janitor::clean_names()
```

```{r, echo=FALSE}
# then load all the relevant packages
pacman::p_load(pacman, knitr, tidyverse, readxl)
```

```{r xaringanExtra-clipboard, echo=FALSE}
# these allow any code snippets to be copied to the clipboard so they 
# can be pasted easily
htmltools::tagList(
    xaringanExtra::use_clipboard(
        button_text = "<i class=\"fa fa-clipboard\"></i>",
        success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    ),
    rmarkdown::html_dependency_font_awesome()
)
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

# Purpose and Agenda

One of the most important aspects of working with geographical data is the presentation and communication of the results. In this lesson, we'll explore how to make stunning and informative maps that can help you convey insights about data in a visually appealing way.

## What we'll do in this presentation

- Final project comments & recommendations
- Revisit Key Concepts from Assignment 9
- 

---

## Final project

* Please review the comments on your final projects and follow up if necessary
* If they do not have the data, please obtain it as soon as possible (really only a month left!)
* Please start data cleaning as soon as possible

---

## Revisit Key Concepts from Assignment 9

**Why may you not want to do this?**

```{r}
#| echo: true
glimpse(elsi_data %>% select(state_name_public_school_latest_available_year))
```


```{r}
#| echo: true
elsi_data <- elsi_data %>% 
    mutate(state_name_public_school_2021_22 = as.double(state_name_public_school_2021_22))
```

---

## Revisit Key Concepts from Assignment 9

```{r}
#| echo: true
elsi_data %>%
    group_by(agency_id_nces_assigned_public_school_latest_available_year) %>% 
    summarize(mean = mean(total_students_all_grades_excludes_ae_public_school_2021_22)) %>%
    arrange(desc(mean)) %>% head()
```

**How would you interpret this?**

A. The largest average number of students in schools was 1240.

B. The largest average number of students in districts was 1240.

---

## Revisit Key Concepts from Assignment 9

```{r}
#| echo: true
elsi_data %>% nrow()
```

```{r}
#| echo: true
elsi_data %>% 
    group_by(school_name) %>% 
    nrow()
```

**Why didn't the number of rows change?**

---

## Revisit Key Concepts from Assignment 9

```{r}
#| echo: true
table(elsi_data$state_name_public_school_latest_available_year)
```

Why would you not want to group by `state_name_public_school_latest_available_year`?

---

## Key Concept: Mapping with ggplot2

There are many ways of mapping with R. Today, we'll focus on mapping with ggplot2.

---

## The maps package

- The maps package contains many outlines of continents, countries, states, and counties.
- To use maps, run the following:

```{{r}}
install.packages("maps")
```

---

## The maps package

- Recall that ggplot2 operates on data frames. Therefore we need some way to translate the maps data into a data frame format the ggplot can use.

```{r}
world_map <- map_data("world")
head(world_map)
```

- `long` is longitude. Things to the west of the prime meridian are negative.
- `lat` is latitude.
- `order` shows in which order ggplot should "connect the dots"
- `region` and `subregion` tell what region or subregion a set of points surrounds.
- `group` is very important! ggplot2's functions can take a group argument which controls (among other things) whether adjacent points should be connected by lines. If they are in the same group, then they get connected, but if they are in different groups then they don’t.
    - Essentially, having to points in different groups means that ggplot "lifts the pen" when going between them.

---

## Make a map with ggplot2

Plot the world with:

```{r}
#| echo: true
ggplot(data = world_map) +
  geom_map(map = world_map,
           aes(x = long,
               y = lat,
               map_id = region)) +
    coord_fixed(1.3)
```

Why `coord_fixed()`? It fixes the relationship between one unit in the y direction and one unit in the x direction. Then, even if you change the outer dimensions of the plot (i.e. by changing the window size or the size of the pdf file you are saving it to (in ggsave for example)), the aspect ratio remains unchanged.

---

## Make a map with ggplot2

Since this is ggplot2, you can customize your graph using the same aesthetics as any ggplot2 object.

```{r}
#| echo: true
ggplot(data = world_map) +
  geom_map(map = world_map,
           aes(x = long,
               y = lat,
               map_id = region),
           fill = "white", 
           size = 1,
           color = "blue") +
    coord_fixed(1.3)
```

---

## Key Concept: Choropleth maps

Geographical heat maps, also known as choropleth maps, are one way of visualizing our geographic data.

```{r}
#| echo: false
#| out.width: 60%
#| fig-align: center
knitr::include_graphics("photo.png")
```

---

## More maps with maps

```{r}
usa_map <- map_data("usa")

ggplot(data = usa_map) +
  geom_map(map = usa_map,
           aes(x = long,
               y = lat,
               map_id = region)) +
    coord_fixed(1.3)
```

---

## More maps with maps

```{r}
state_map <- map_data("state")

ggplot(data = state_map) +
  geom_map(map = state_map,
           aes(x = long,
               y = lat,
               fill = region, # different color for each state
               map_id = region)) +
    coord_fixed(1.3) +
    theme(legend.position = "none") # remove the legend
```

---

## More maps with maps

Since we are working with a dataframe, we can run our usual dplyr functions to get what we need.

```{r}
tn_map <-
    state_map %>% 
    filter(region == "tennessee")

ggplot(data = tn_map) +
  geom_map(map = tn_map,
           aes(x = long,
               y = lat,
               map_id = region)) +
    coord_fixed(1.3) +
    theme(legend.position = "none") # remove the legend
```

---

# What's next?

.panelset[

.panel[.panel-name[Weekly Assignment]

- In this week's assignment, you will tidy a data set while also practicing selecting and renaming variables and joining a second data set

]

.panel[.panel-name[Mini-Project]

- The mini-project is now available in Canvas! You will be using recent data from the Tennessee Department of Education. While the data is specified, the analyses you conduct to answer two questions of the data are more open-ended in nature. You'll have two week to complete this, to allow for time for you to ask questions and dig deep into the data. One pointer - note that many of the variables are at the school-level and represent the percentage of teachers who chose a particular response. How you choose to "wrangle" or prepare the data given the nature of these variables is an important consideration as you work on your mini project. Our goal with this assignment is not perfection, but rather for you to practice capabilities you have developed over the semester. This is reflected in the grading rubric for the assignment!

]

.panel[.panel-name[Data]

- The data we'll use comes from the [*National Teacher and Principal Survey*](https://nces.ed.gov/surveys/ntps/) and is on the number of full-time nurses in schools in U.S. states.

.panel[.panel-name[Optional Substantive Reading(s)]

Substantive reading(s):

> Mann, B., & Saultz, A. (2019). The role of place, geography, and geographic information systems in educational research. Aera Open, 5(3), https://journals.sagepub.com/doi/10.1177/2332858419869340

This is linked in Canvas.

]

.panel[.panel-name[Technical Reading(s)]

- Technical reading(s):

> on mapping

This is also linked in Canvas.

]

]